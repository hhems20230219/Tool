<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bingo（新興 ⊇ EMT｜專屬新興／專屬EMT）</title>

  <!-- Bootstrap 5 & jQuery（CDN） -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root{
      --cell-gap: 8px;
      --cell-radius: 10px;
      --cell-border: 2px;
      --cell-bg: #f8f9fa;
      --cell-active: #ffe08a;
      --cell-hover: #f1f3f5;
      --cell-border-color: #dee2e6;
    }
    body { background:#fff; }

    .toolbar {
      max-width: 920px;
      margin: 20px auto 0;
      padding: 0 12px;
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 8px 12px;
      align-items: center;
    }
    @media (max-width: 576px){
      .toolbar { grid-template-columns: 1fr 1fr; }
    }

    .bingo-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: var(--cell-gap);
      width: 100%;
      max-width: 920px;
      margin: 12px auto 32px;
      padding: 0 var(--cell-gap);
    }
    .bingo-cell {
      position: relative;
      aspect-ratio: 1 / 1;
      border: var(--cell-border) solid var(--cell-border-color);
      border-radius: var(--cell-radius);
      background: var(--cell-bg);
      cursor: pointer;
      transition: background-color .15s ease, transform .05s ease;
      user-select: none;
      -webkit-tap-highlight-color: transparent;

      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 6%;
      overflow: hidden;
    }
    .bingo-cell:hover { background: var(--cell-hover); }
    .bingo-cell:active { transform: scale(0.98); }
    .bingo-cell.active {
      background: var(--cell-active);
      box-shadow: inset 0 0 0 2px rgba(0,0,0,.06);
    }
    .bingo-label {
      width: 100%;
      line-height: 1.1;
      word-break: break-word;
      font-size: clamp(12px, 2.3vw, 22px);
      font-weight: 600;
      color: #343a40;
    }
    @supports not (aspect-ratio: 1 / 1) {
      .bingo-cell::before{ content:""; display:block; padding-top:100%; }
      .bingo-cell > .bingo-label{ position:absolute; inset:6%; }
    }
  </style>
</head>
<body>

  <div class="toolbar">
    <!-- 左：詞庫選擇 -->
    <div class="d-flex align-items-center gap-2">
      <label for="poolSelect" class="form-label mb-0">詞庫</label>
      <select id="poolSelect" class="form-select form-select-sm" style="max-width: 180px;">
        <option value="ALL">全部</option>
        <option value="SINSING">專屬新興</option>
        <option value="EMT">專屬EMT</option>
      </select>
      <span class="badge text-bg-light">可用詞數：<span id="poolSize">0</span></span>
    </div>

    <!-- 中：統計 -->
    <div class="d-flex align-items-center gap-2 justify-content-end">
      <span class="badge text-bg-secondary">連線：<span id="lineCount">0</span></span>
      <span class="badge text-bg-light">已選：<span id="activeCount">0</span></span>
    </div>

    <!-- 右：操作 -->
    <div class="d-flex gap-2 justify-content-end">
      <button id="btnRandom" class="btn btn-primary btn-sm">隨機填入</button>
    </div>
  </div>

  <div class="bingo-grid" id="bingoGrid">
    <!-- 25 格 -->
    <div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div>
    <div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div>
    <div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div>
    <div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div>
    <div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div><div class="bingo-cell"></div>
  </div>

  <script>
    // ───────── 詞庫定義 ─────────
    // 共用詞（多數情境/醫院）
    const COMMON = [
      '高醫','阮綜合醫院','大同醫院','聖功醫院','長庚醫院','榮民總醫院','凱旋醫院','民生醫院',
      '火警救護','遇到精神病患','明顯死亡(屍僵屍腐）','明顯死亡（頭首分離）',
      '急產接生','斷肢','發燒','MI','COPD','一氧化碳中毒',
      '酒醉路到','吸毒過量','自殘','同時有3個以上傷患'
    ];
    // 專屬新興（在地用語/分隊日常）
    const SINSING_ONLY = [
      '下雨天協勤','小飛俠','晴天娃娃','打撈','線上派遣',
      '獨自評估患者','獨自處置患者'
    ];
    // 專屬 EMT（技術與處置）
    const EMT_ONLY = [
      '內科OHCA','Trauma OHCA','車上CPR',
      '強制送醫使用約束帶','解鎖燒燙傷','瀕死式呼吸','耳漏鼻漏','頭部外傷 GCS小於15','骨盆不穩定',
      '執行辛辛那提異常','EKG','血糖','備IV','上頸圈','翻身上長背板','破門',
      '正確使用器材給氧','BVM給氧','進階呼吸道給氧',
      '架設盧卡斯','使用電動擔架','使用搬運椅','使用傳統擔架','抽吸式護木',
      '非OHCA GCS 3分','低血糖','低血壓','醫師線上指導'
    ];

    // 去重
    const uniq = arr => Array.from(new Set(arr));

    // 下拉邏輯：新興 ⊇ EMT
    function getActivePool() {
      const mode = $('#poolSelect').val();
      if (mode === 'SINSING') return uniq([...COMMON, ...SINSING_ONLY, ...EMT_ONLY]); // EMT 也包含
      if (mode === 'EMT')     return uniq([...COMMON, ...EMT_ONLY]);
      return uniq([...COMMON, ...SINSING_ONLY, ...EMT_ONLY]); // ALL
    }

    // 連線線組（5 橫、5 直、2 對角）
    const LINES = [
      [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],             // rows
      [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],             // cols
      [0,6,12,18,24],[4,8,12,16,20]                                                            // diagonals
    ];

    // 小工具
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random() * (i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    const take = (arr, n) => arr.slice(0, n);

    // UI 更新
    function updatePoolSizeBadge(){
      $('#poolSize').text(getActivePool().length);
    }
    function fillGrid(items) {
      const $cells = $('#bingoGrid .bingo-cell');
      for (let i = 0; i < 25; i++) {
        const text = items[i] ?? '';
        const $label = $('<div/>', { 'class':'bingo-label', text });
        $cells.eq(i).empty().append($label);
      }
    }
    function clearSelection() {
      $('#bingoGrid .bingo-cell').removeClass('active');
      updateCounters();
    }
    function countLines() {
      const $cells = $('#bingoGrid .bingo-cell');
      let lines = 0;
      for (const line of LINES) {
        let ok = true;
        for (const idx of line) {
          if (!$cells.eq(idx).hasClass('active')) { ok = false; break; }
        }
        if (ok) lines++;
      }
      return lines;
    }
    function updateCounters() {
      const activeCount = $('#bingoGrid .bingo-cell.active').length;
      $('#activeCount').text(activeCount);
      $('#lineCount').text(countLines());
    }

    // 隨機填入（若有選取→先警示→確認後清空選取）
    function randomFillWithConfirm() {
      const pool = getActivePool();
      if (pool.length === 0) {
        alert('目前詞庫為空，請調整下拉選單或補詞。');
        return;
      }
      const hasActive = $('#bingoGrid .bingo-cell.active').length > 0;
      if (hasActive) {
        const ok = window.confirm('將重置目前已選取的格子顏色並重新隨機填入，確定要繼續嗎？');
        if (!ok) return;
      }
      clearSelection(); // 重置顏色&計數
      const selected = take(shuffle(pool), 25);
      fillGrid(selected);
      updateCounters(); // 連線=0、已選=0
    }

    // 事件
    $('#btnRandom').on('click', randomFillWithConfirm);
    $('#poolSelect').on('change', function() {
      updatePoolSizeBadge();
      // 切換詞庫時自動重抽（保留你的警示重置流程）
      randomFillWithConfirm();
    });
    $(document).on('click', '.bingo-cell', function () {
      $(this).toggleClass('active');
      updateCounters();
    });

    // 初始
    $(function(){
      updatePoolSizeBadge();
      randomFillWithConfirm();
    });
  </script>
</body>
</html>
